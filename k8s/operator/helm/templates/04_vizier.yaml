apiVersion: px.dev/v1alpha1
kind: Vizier
metadata:
  name: {{ .Values.name }}
  namespace: {{ .Release.Namespace }}
spec:
  {{- if .Values.version }}
  version: {{ .Values.version }}
  {{- end }}
  deployKey: {{ .Values.deployKey }}
  cloudAddr: {{ .Values.cloudAddr }}
  disableAutoUpdate: {{ .Values.disableAutoUpdate }}
  useEtcdOperator: {{ .Values.useEtcdOperator }}
  {{- if .Values.clusterName }}
  clusterName: {{ .Values.clusterName }}
  {{- end }}
  {{- if .Values.devCloudNamespace }}
  devCloudNamespace: {{ .Values.devCloudNamespace }}
  {{- end }}
  {{- if .Values.pemMemoryLimit }}
  pemMemoryLimit: {{ .Values.pemMemoryLimit }}
  {{- end }}
  {{- if .Values.dataAccess }}
  dataAccess: {{ .Values.dataAccess }}
  {{- end }}
  {{- if .Values.patches }}
  patches: {{ .Values.patches | toYaml | nindent 4 }}
  {{- end }}
  {{- if .Values.dataCollectorParams }}
  dataCollectorParams:
    {{- if .Values.dataCollectorParams.datastreamBufferSize }}
    datastreamBufferSize: {{ .Values.dataCollectorParams.datastreamBufferSize }}
    {{- end }}
    {{- if .Values.dataCollectorParams.datastreamBufferSpikeSize }}
    datastreamBufferSpikeSize: {{ .Values.dataCollectorParams.datastreamBufferSpikeSize }}
    {{- end }}
    {{- if .Values.dataCollectorParams.tableStoreTableSizeLimit }}
    tableStoreTableSizeLimit: {{ .Values.dataCollectorParams.tableStoreTableSizeLimit }}
    {{- end }}
  {{- end}}
  {{- if .Values.leadershipElectionParams }}
    {{- if .Values.leadershipElectionParams.electionPeriodMs }}
    electionPeriodMs: {{ .Values.leadershipElectionParams.electionPeriodMs }}
    {{- end }}
  {{- end }}
  {{- if or .Values.pod.annotations (or .Values.pod.labels .Values.pod.resources) }}
  pod:
    {{- if .Values.pod.annotations }}
    annotations: {{ .Values.pod.annotations | toYaml | nindent 6 }}
    {{- end }}
    {{- if .Values.pod.labels }}
    labels: {{ .Values.pod.labels | toYaml | nindent 6 }}
    {{- end }}
    {{- if .Values.pod.resources }}
    resources: {{ .Values.pod.resources | toYaml | nindent 6 }}
    {{- end }}
  {{- end }}
