# Third-party libraries

## How to add a new submodule

*   Create a **private** fork of the original repo, under our github username `pixie-labs`.
    See reference [1] for detailed steps.
*   Create a new branch called `pixie` tracking the desired commit.
*   Add this new repo as the submodule:
    ```
    git submodule add --force git@github.com:pixie-labs/<repo>.git third_party/<repo>
    ```
*   Create diff and get it submitted.


## How to update a submodule

There are 2 steps:

*   First update the `pixie` branch on the private fork.
*   Then update the submodule reference in our repo.

To update the private fork:

*   Clone the private fork on your host. Checkout the `pixie` branch
*   Make changes.
*   Utilize the normal github pull request process to do the review and landing.
*   Submit the change through `git push`.

To update the submodule reference in our repo:

*   In our repo, `cd third_party/<repo>`.
*   Check out and pull from `pixie` branch: `git checkout pixie && git pull`.
*   Create a diff which updates the submodule to the head of `pixie` branch.
*   Review and land the diff through the Phabricator process.
*   Send a notice to `eng` channel to ask people update their submodules.

### References

1.  https://medium.com/@bilalbayasut/github-how-to-make-a-fork-of-public-repository-private-6ee8cacaf9d3

## bpftrace notes

When building bpftrace, it automatically generates the following file:
<build_dir>/resources/headers.cpp

Due to build issues, this file was copied directly into bpftrace/src, and checked in to our fork of bpftrace.

If at any time, bpftrace is updated from the origin, AND there are changes to the bpftrace/resources directory,
then the updated headers.cpp should be copied and checked in to bpftrace/src.

If there are no changes to files in the bpftrace/resources directory (which is the likely case), then no special steps are required.

## nghttp2 notes

nghttp2.patch is generated by cloning the nghttp2 repo and make a change to the CMakeLists.txt, and
copy the diff.
